@page "/dashboard"
@inject BudgetExperiment.Client.Api.IBudgetApiClient Api

<PageTitle>Dashboard</PageTitle>

<h2>Dashboard</h2>

@if (summary is null)
{
    <p><em>Loading...</em></p>
}
else
{
    <div class="stats">
        <div class="stat">Pay Schedules: <strong>@summary.PayScheduleCount</strong></div>
        <div class="stat">Bill Schedules: <strong>@summary.BillScheduleCount</strong></div>
    </div>

    <h3>Recent Pay Schedules</h3>
    @if (summary.RecentPaySchedules.Count == 0)
    {
        <p><em>None</em></p>
    }
    else
    {
        <table class="table table-sm">
            <thead><tr><th>Anchor</th><th>Recurrence</th><th>Created (UTC)</th></tr></thead>
            <tbody>
            @foreach (var p in summary.RecentPaySchedules)
            {
                <tr><td>@p.Anchor</td><td>@p.Recurrence</td><td>@p.CreatedUtc.ToString("u")</td></tr>
            }
            </tbody>
        </table>
    }

    <h3>Recent Bill Schedules</h3>
    @if (summary.RecentBillSchedules.Count == 0)
    {
        <p><em>None</em></p>
    }
    else
    {
        <table class="table table-sm">
            <thead><tr><th>Name</th><th>Amount</th><th>Anchor</th><th>Recurrence</th><th>Created (UTC)</th></tr></thead>
            <tbody>
            @foreach (var b in summary.RecentBillSchedules)
            {
                <tr><td>@b.Name</td><td>@b.Amount @b.Currency</td><td>@b.Anchor</td><td>@b.Recurrence</td><td>@b.CreatedUtc.ToString("u")</td></tr>
            }
            </tbody>
        </table>
    }
}

@code {
    private BudgetExperiment.Client.Api.DashboardSummary? summary;

    protected override async Task OnInitializedAsync()
    {
        summary = await Api.GetDashboardAsync();
    }
}